<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>Orloj minimale SVG</title>
    <style>
        @font-face {
            font-family: "AstroSymbols";
            src: url("AstroSymbols.ttf");
        }

        .zodiac {
            font-family: "AstroSymbols";
            font-size: 22px;
            fill: #d6b25e;
        }
    

    body {
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: sans-serif;
    }

    svg {
    background: #1b1b1b;
    border-radius: 50%;
    }

    text {
    fill: #ddd;
    font-size: 14px;
    text-anchor: middle;
    dominant-baseline: middle;
    }
    </style>
</head>

<body>

    <svg viewBox="-200 -200 400 400" width="500">

        <!-- bordo -->
        <circle r="190" fill="none" stroke="#888" stroke-width="4" />

        <!-- ore 0–23 -->
        <g id="hours"></g>
        <!-- anello zodiacale -->
        <!--  <g id="zodiac-ring">
            <circle r="120" fill="none" stroke="#c9a24d" stroke-width="3" />

            <g id="zodiac-symbols"></g>
        </g> -->
        <!-- eclittica -->
        <g id="ecliptic-tilt" transform="rotate(-23.44)">
            <g id="ecliptic-scale" transform="scale(1,0.92)">

                <g id="zodiac-ring">
                    <circle r="120" fill="none" stroke="#c9a24d" stroke-width="3" />
                    <g id="zodiac-symbols"></g>
                </g>

            </g>
        </g>

        

        <!-- sole -->
        <g id="sun-hand">
            <line x1="0" y1="0" x2="0" y2="-140" stroke="gold" stroke-width="3" />
            <circle cx="0" cy="-140" r="8" fill="gold" />
        </g>

        

        <!-- luna -->
        <g id="moon-hand">
            <line x1="0" y1="0" x2="0" y2="-110" stroke="silver" stroke-width="2" />
            <circle cx="0" cy="-110" r="6" fill="silver" />
        </g>
        <!-- luna con fase -->
        <g id="moon-hand">
            <line x1="0" y1="0" x2="0" y2="-110" stroke="silver" stroke-width="2" />

            <g transform="translate(0,-110)">
                <defs>
                    <mask id="moon-mask">
                        <!-- base visibile -->
                        <rect x="-20" y="-20" width="40" height="40" fill="white" />
                        <!-- ombra -->
                        <circle id="moon-shadow" cx="0" cy="0" r="8" fill="black" />
                    </mask>
                </defs>

                <!-- disco lunare -->
                <circle r="8" fill="#ddd" mask="url(#moon-mask)" />
                <circle r="8" fill="none" stroke="#aaa" stroke-width="1" />
            </g>
        </g>


    </svg>

    <script>
        //const zodiacRing = document.getElementById("zodiac-ring");
        const zodiacRing = document.getElementById("zodiac-ring");

        const hoursGroup = document.getElementById("hours");
        const sunHand = document.getElementById("sun-hand");
        const moonHand = document.getElementById("moon-hand");
        const moonShadow = document.getElementById("moon-shadow");

        /* ---- disegna ore ---- */
        for (let h = 0; h < 24; h++) {
            const angle = h * 15; // 360/24
            const r = 160;

            const x = r * Math.sin(angle * Math.PI / 180);
            const y = -r * Math.cos(angle * Math.PI / 180);

            const t = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "text"
            );
            t.setAttribute("x", x);
            t.setAttribute("y", y);
            t.textContent = h;
            hoursGroup.appendChild(t);
        }
        const zodiacGroup = document.getElementById("zodiac-symbols");

        /*  const zodiac = [
             "♈", "♉", "♊", "♋", "♌", "♍",
             "♎", "♏", "♐", "♑", "♒", "♓"
         ]; */
        const zodiac = [
            "\u2648", // Aries
            "\u2649", // Taurus
            "\u264A", // Gemini
            "\u264B", // Cancer
            "\u264C", // Leo
            "\u264D", // Virgo
            "\u264E", // Libra
            "\u264F", // Scorpio
            "\u2650", // Sagittarius
            "\u2651", // Capricorn
            "\u2652", // Aquarius
            "\u2653"  // Pisces
        ];


        zodiac.forEach((sign, i) => {
            const angle = i * 30; // 360 / 12
            const r = 120;

            const x = r * Math.sin(angle * Math.PI / 180);
            const y = -r * Math.cos(angle * Math.PI / 180);

            const t = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "text"
            );

            t.setAttribute("x", x);
            t.setAttribute("y", y);
            t.setAttribute("font-size", "20");
            t.textContent = sign;
            t.setAttribute("class", "zodiac");
            t.setAttribute("text-anchor", "middle");
            t.setAttribute("dominant-baseline", "middle");


            zodiacGroup.appendChild(t);
        });

        /* ---- luna: riferimento luna nuova ---- */
        const lunarPeriod = 29.53059;
        const refNewMoon = new Date("2024-01-11T00:00:00Z");

        function update() {
            const now = new Date();

            /* Sole (24h) */
            const h =
                now.getHours() +
                now.getMinutes() / 60 +
                now.getSeconds() / 3600;

            const sunAngle = h * 15;
            sunHand.setAttribute(
                "transform",
                `rotate(${sunAngle})`
            );

            /* Luna */
            const days =
                (now - refNewMoon) /
                (1000 * 60 * 60 * 24);
            const phase = (days % lunarPeriod) / lunarPeriod;
            // 0 = nuova, 0.25 = primo quarto, 0.5 = piena

            let offset;
            if (phase < 0.5) {
                // crescente
                offset = (0.5 - phase) * 16;
            } else {
                // calante
                offset = (phase - 0.5) * -16;
            }

            moonShadow.setAttribute("cx", offset);

            const moonAngle =
                (days / lunarPeriod) * 360;

            moonHand.setAttribute(
                "transform",
                `rotate(${moonAngle})`
            );
            const yearDays = 365.2422;
            const springEquinox = new Date("2024-03-20T03:00:00Z");

            const zodiacAngle =
                ((now - springEquinox) /
                    (1000 * 60 * 60 * 24 * yearDays)) * 360;

            zodiacRing.setAttribute(
                "transform",
                `rotate(${zodiacAngle})`
            );
            /* 
            const yearDays = 365.2422;
            const springEquinox = new Date("2024-03-20T03:00:00Z");
            
            const zodiacAngle =
              ((now - springEquinox) /
              (1000 * 60 * 60 * 24 * yearDays)) * 360;
            
            zodiacRing.setAttribute(
              "transform",
              `rotate(${zodiacAngle})`
            ); */

            requestAnimationFrame(update);
        }

        update();
    </script>

</body>

</html>