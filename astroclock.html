<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orologio Astronomico</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    h1 {
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      font-size: 2em;
    }
    
    .clock-container {
      position: relative;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5),
                  inset 0 0 30px rgba(255,255,255,0.1);
    }
    
    canvas {
      display: block;
      border-radius: 50%;
      background: radial-gradient(circle at center, #1a1a2e 0%, #0a0a15 100%);
    }
    
    .info-panel {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      max-width: 600px;
      text-align: center;
    }
    
    .info-row {
      display: flex;
      justify-content: space-around;
      gap: 30px;
      margin-top: 15px;
      font-size: 14px;
    }
    
    .info-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .info-label {
      font-size: 12px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: bold;
      color: #ffd700;
    }
    
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    label {
      font-size: 11px;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    input {
      padding: 8px 12px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 13px;
      font-family: monospace;
    }
    
    input::placeholder {
      color: rgba(255,255,255,0.4);
    }
  </style>
</head>
<body>
  <h1>‚è∞ Orologio Astronomico</h1>
  
  <div class="clock-container">
    <canvas id="clockCanvas" width="500" height="500"></canvas>
  </div>
  
  <div class="info-panel">
    <div id="timeDisplay" style="font-size: 24px; font-weight: bold; margin-bottom: 10px;"></div>
    <div id="dateDisplay" style="font-size: 16px; opacity: 0.8; margin-bottom: 15px;"></div>
    
    <div class="info-row">
      <div class="info-item">
        <div class="info-label">‚òâ Sole</div>
        <div class="info-value" id="sunSign">--</div>
      </div>
      <div class="info-item">
        <div class="info-label">‚òΩ Luna</div>
        <div class="info-value" id="moonPhase">--</div>
      </div>
      <div class="info-item">
        <div class="info-label">Illuminazione</div>
        <div class="info-value" id="moonIllum">--</div>
      </div>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <label>Latitudine</label>
        <input type="number" id="latitude" value="46,07" step="0.01" style="width: 100px;">
      </div>
      <div class="control-group">
        <label>Longitudine</label>
        <input type="number" id="longitude" value="11.121" step="0.01" style="width: 100px;">
      </div>
    </div>
  </div>

  <script>
    // =========================================================================
    // CALCOLI ASTRONOMICI
    // =========================================================================
    const sind  = d => Math.sin(d * Math.PI / 180);
    const cosd  = d => Math.cos(d * Math.PI / 180);
    const tand  = d => Math.tan(d * Math.PI / 180);
    const deg   = r => r * 180 / Math.PI;
    const atan2d = (y, x) => deg(Math.atan2(y, x));
    const mod   = (x, n) => ((x % n) + n) % n;

    function julianDay(date) {
      let y = date.getUTCFullYear();
      let m = date.getUTCMonth() + 1;
      const d = date.getUTCDate();
      const ut = date.getUTCHours() + date.getUTCMinutes() / 60 
               + date.getUTCSeconds() / 3600 + date.getUTCMilliseconds() / 3_600_000;
      if (m <= 2) { y -= 1; m += 12; }
      const A = Math.trunc(y / 100);
      const B = 2 - A + Math.trunc(A / 4);
      return Math.trunc(365.25 * (y + 4716)) + Math.trunc(30.6001 * (m + 1)) 
             + d + ut / 24 + B - 1524.5;
    }

    const ZODIAC_SIGNS = [
      'Ariete ‚ôà', 'Toro ‚ôâ', 'Gemelli ‚ôä', 'Cancro ‚ôã',
      'Leone ‚ôå', 'Vergine ‚ôç', 'Bilancia ‚ôé', 'Scorpione ‚ôè',
      'Sagittario ‚ôê', 'Capricorno ‚ôë', 'Acquario ‚ôí', 'Pesci ‚ôì',
    ];

    function zodiacSign(eclipticLongitude) {
      return ZODIAC_SIGNS[Math.trunc(mod(eclipticLongitude, 360) / 30)];
    }

    function sunPosition(latitude, longitude, date) {
      const jd = julianDay(date);
      const T  = (jd - 2451545.0) / 36525.0;
      const M = mod(357.52911 + 35999.05029 * T - 0.0001537 * T ** 2, 360);
      const L0 = mod(280.46646 + 36000.76983 * T + 0.0003032 * T ** 2, 360);
      const C = (1.914602 - 0.004817 * T - 0.000014 * T ** 2) * sind(M)
              + (0.019993 - 0.000101 * T) * sind(2 * M)
              +  0.000289 * sind(3 * M);
      const sunLon = mod(L0 + C, 360);
      const omega = 125.04 - 1934.136 * T;
      const apparentLon = mod(sunLon - 0.00569 - 0.00478 * sind(omega), 360);
      return { longitudeEcliptic: apparentLon, zodiac: zodiacSign(apparentLon) };
    }

    function moonPosition(latitude, longitude, date) {
      const jd = julianDay(date);
      const T = (jd - 2451545.0) / 36525.0;
      const T2 = T * T;
      const Lp = mod(218.3164477 + 481267.88123421 * T - 0.0015786 * T2, 360);
      const D = mod(297.8501921 + 445267.1114034 * T - 0.0018819 * T2, 360);
      const M = mod(357.5291092 + 35999.0502909 * T - 0.0001536 * T2, 360);
      const Mp = mod(134.9633964 + 477198.8675055 * T + 0.0087414 * T2, 360);
      const F = mod(93.2720950 + 483202.0175233 * T - 0.0036539 * T2, 360);

      const sumL = 6288774 * sind(Mp) + 1274027 * sind(2*D - Mp) + 658314 * sind(2*D)
                 + 213618 * sind(2*Mp) + -185116 * sind(M) + -114332 * sind(2*F)
                 + 58793 * sind(2*D - 2*Mp) + 57066 * sind(2*D - M - Mp);
      const moonLon = mod(Lp + sumL / 1000000, 360);
      
      const sumB = 5128122 * sind(F) + 280602 * sind(Mp + F) + 277693 * sind(Mp - F);
      const moonLat = sumB / 1000000;

      const sunLon = sunPosition(latitude, longitude, date).longitudeEcliptic;
      const phase = mod(moonLon - sunLon, 360);
      const illumination = (1 - cosd(phase)) / 2 * 100;

      return { 
        longitudeEcliptic: moonLon, 
        latitudeEcliptic: moonLat,
        phase, 
        illumination,
        zodiac: zodiacSign(moonLon)
      };
    }

    function getPhaseName(phase) {
      if (phase < 22.5 || phase > 337.5) return 'üåë Nuova';
      else if (phase < 67.5) return 'üåí Crescente';
      else if (phase < 112.5) return 'üåì Primo Q.';
      else if (phase < 157.5) return 'üåî Gibbosa Cr.';
      else if (phase < 202.5) return 'üåï Piena';
      else if (phase < 247.5) return 'üåñ Gibbosa Ca.';
      else if (phase < 292.5) return 'üåó Ultimo Q.';
      else return 'üåò Calante';
    }

    // =========================================================================
    // DISEGNO OROLOGIO
    // =========================================================================
    const canvas = document.getElementById('clockCanvas');
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const clockRadius = 200;

    function drawClock() {
      const now = new Date();
      const lat = parseFloat(document.getElementById('latitude').value);
      const lon = parseFloat(document.getElementById('longitude').value);

      const sunPos = sunPosition(lat, lon, now);
      const moonPos = moonPosition(lat, lon, now);

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Sfondo con stelle
      const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, clockRadius);
      gradient.addColorStop(0, '#2a2a4a');
      gradient.addColorStop(1, '#0a0a15');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Stelle casuali
      ctx.fillStyle = '#fff';
      for (let i = 0; i < 100; i++) {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.random() * clockRadius;
        const x = centerX + Math.cos(angle) * dist;
        const y = centerY + Math.sin(angle) * dist;
        const size = Math.random() * 1.2;
        ctx.globalAlpha = Math.random() * 0.7 + 0.3;
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      // Bordo esterno orologio
      ctx.strokeStyle = '#4a4a6a';
      ctx.lineWidth = 8;
      ctx.beginPath();
      ctx.arc(centerX, centerY, clockRadius + 10, 0, Math.PI * 2);
      ctx.stroke();

      ctx.strokeStyle = '#6a6a8a';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(centerX, centerY, clockRadius + 18, 0, Math.PI * 2);
      ctx.stroke();

      // Eclittica (anello zodiacale)
      const eclipticRadius = clockRadius - 30;
      ctx.strokeStyle = 'rgba(255, 215, 0, 0.3)';
      ctx.lineWidth = 25;
      ctx.beginPath();
      ctx.arc(centerX, centerY, eclipticRadius, 0, Math.PI * 2);
      ctx.stroke();

      // Segni zodiacali
      ctx.font = 'bold 22px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let i = 0; i < 12; i++) {
        const angle = (i * 30 - 90) * Math.PI / 180; // -90 per iniziare dall'Ariete in alto
        const x = centerX + Math.cos(angle) * eclipticRadius;
        const y = centerY + Math.sin(angle) * eclipticRadius;
        ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
        ctx.fillText(ZODIAC_SIGNS[i].split(' ')[1], x, y);
      }

      // Sole sull'eclittica
      const sunAngle = (sunPos.longitudeEcliptic - 90) * Math.PI / 180;
      const sunX = centerX + Math.cos(sunAngle) * eclipticRadius;
      const sunY = centerY + Math.sin(sunAngle) * eclipticRadius;
      
      const sunGradient = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, 12);
      sunGradient.addColorStop(0, '#fff');
      sunGradient.addColorStop(0.4, '#ffeb3b');
      sunGradient.addColorStop(1, '#ff9800');
      ctx.fillStyle = sunGradient;
      ctx.beginPath();
      ctx.arc(sunX, sunY, 10, 0, Math.PI * 2);
      ctx.fill();

      // Alone solare
      ctx.strokeStyle = 'rgba(255, 235, 59, 0.4)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(sunX, sunY, 15, 0, Math.PI * 2);
      ctx.stroke();

      // Luna sull'eclittica
      const moonAngle = (moonPos.longitudeEcliptic - 90) * Math.PI / 180;
      const moonX = centerX + Math.cos(moonAngle) * eclipticRadius;
      const moonY = centerY + Math.sin(moonAngle) * eclipticRadius;
      
      // Luna base
      ctx.fillStyle = '#d0d0d0';
      ctx.beginPath();
      ctx.arc(moonX, moonY, 8, 0, Math.PI * 2);
      ctx.fill();

      // Fase lunare (ombra)
      const illumination = moonPos.illumination / 100;
      if (illumination < 0.99) {
        ctx.save();
        ctx.translate(moonX, moonY);
        const sunToMoonAngle = Math.atan2(moonY - sunY, moonX - sunX);
        ctx.rotate(sunToMoonAngle);
        ctx.fillStyle = '#1a1a2e';
        ctx.beginPath();
        if (illumination < 0.5) {
          const offset = (0.5 - illumination) * 2 * 8;
          ctx.ellipse(offset, 0, 8, 8, 0, 0, Math.PI * 2);
        } else {
          const offset = (illumination - 0.5) * 2 * 8;
          ctx.ellipse(-offset, 0, 8, 8, 0, 0, Math.PI * 2);
        }
        ctx.fill();
        ctx.restore();
      }

      // Bordo luna
      ctx.strokeStyle = '#a0a0a0';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(moonX, moonY, 8, 0, Math.PI * 2);
      ctx.stroke();

      // Numeri ore (12, 3, 6, 9)
      ctx.font = 'bold 32px Lucida';
      ctx.fillStyle = '#fff';
      const hourRadius = clockRadius - 60;
      for (let i = 0; i < 12; i += 1) {
        const angle = (i * 30 - 90) * Math.PI / 180;
        const x = centerX + Math.cos(angle) * hourRadius;
        const y = centerY + Math.sin(angle) * hourRadius;
        ctx.fillText(i === 0 ? 12 : i, x, y);
      }

      // Tacche ore
      ctx.strokeStyle = '#888';
      ctx.lineWidth = 3;
      for (let i = 0; i < 12; i++) {
        const angle = (i * 30 - 90) * Math.PI / 180;
        const x1 = centerX + Math.cos(angle) * (clockRadius - 15);
        const y1 = centerY + Math.sin(angle) * (clockRadius - 15);
        const x2 = centerX + Math.cos(angle) * (clockRadius - 5);
        const y2 = centerY + Math.sin(angle) * (clockRadius - 5);
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }

      // Tacche minuti
      ctx.strokeStyle = '#555';
      ctx.lineWidth = 1;
      for (let i = 0; i < 60; i++) {
        if (i % 5 === 0) continue; // Salta le tacche delle ore
        const angle = (i * 6 - 90) * Math.PI / 180;
        const x1 = centerX + Math.cos(angle) * (clockRadius - 10);
        const y1 = centerY + Math.sin(angle) * (clockRadius - 10);
        const x2 = centerX + Math.cos(angle) * (clockRadius - 5);
        const y2 = centerY + Math.sin(angle) * (clockRadius - 5);
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }

      // Lancette
      const hours = now.getHours() % 12;
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();

      // Lancetta ore
      const hourAngle = ((hours + minutes / 60) * 30 - 90) * Math.PI / 180;
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 6;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(
        centerX + Math.cos(hourAngle) * (clockRadius * 0.4),
        centerY + Math.sin(hourAngle) * (clockRadius * 0.4)
      );
      ctx.stroke();

      // Lancetta minuti
      const minuteAngle = ((minutes + seconds / 60) * 6 - 90) * Math.PI / 180;
      ctx.strokeStyle = '#ddd';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(
        centerX + Math.cos(minuteAngle) * (clockRadius * 0.6),
        centerY + Math.sin(minuteAngle) * (clockRadius * 0.6)
      );
      ctx.stroke();

      // Lancetta secondi
      const secondAngle = (seconds * 6 - 90) * Math.PI / 180;
      ctx.strokeStyle = '#ff6b6b';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(
        centerX + Math.cos(secondAngle) * (clockRadius * 0.7),
        centerY + Math.sin(secondAngle) * (clockRadius * 0.7)
      );
      ctx.stroke();

      // Centro dell'orologio
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = '#ff6b6b';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Aggiorna info pannello
      updateInfoPanel(now, sunPos, moonPos);
    }

    function updateInfoPanel(date, sunPos, moonPos) {
      const timeStr = date.toLocaleTimeString('it-IT');
      const dateStr = date.toLocaleDateString('it-IT', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      document.getElementById('timeDisplay').textContent = timeStr;
      document.getElementById('dateDisplay').textContent = dateStr;
      document.getElementById('sunSign').textContent = sunPos.zodiac;
      document.getElementById('moonPhase').textContent = getPhaseName(moonPos.phase);
      document.getElementById('moonIllum').textContent = moonPos.illumination.toFixed(0) + '%';
    }

    // Aggiorna orologio ogni secondo
    setInterval(drawClock, 1000);
    drawClock();

    // Aggiorna quando cambiano le coordinate
    document.getElementById('latitude').addEventListener('change', drawClock);
    document.getElementById('longitude').addEventListener('change', drawClock);
  </script>
</body>
</html>